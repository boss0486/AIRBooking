<!--

@using WebCore.Entities;
@using WebCore.Services;
@using WebCore.Model.Services
@model  WebCore.Entities.BookOrderDetails
@{
    ViewBag.Title = Helper.MetaSEO.MetaTitle;
    List<BookTicketDetails> tickets = new List<BookTicketDetails>();
    List<BookPassengerDetails> passengers = new List<BookPassengerDetails>();
    var pnr = string.Empty;

    if (Model != null)
    {
        pnr = "";
        if (Model.AppBookTicketDetails != null)
        {
            tickets = Model.AppBookTicketDetails.ToList();
            pnr = tickets[0].PNR;
        }
        if (Model.AppBookPassengerDetails != null)
        {
            passengers = Model.AppBookPassengerDetails.ToList();
        }
    }
    double amountFareTotal = 0;
}
<div class="card book-in details">
    <div class="header" style="background:#FFF;">
        <h3><i class="fas fa-plane-departure" style="font-size:21px;"></i> Xuất vé @Helper.Current.GetSiteID </h3>
    </div>

    <div class="body" id="BookingForm">
        <div class="top-pic mgb-20">
            <label><i class="fa fa-check-circle" aria-hidden="true"></i> Thông tin chuyến bay:</label>
        </div>
        <div class="row">
            <div class="col-md-6"><label style="color:#ff0000; font-size:16px;"><i style="color:#ff0000; font-size:16px;" class="fas fa-qrcode"></i> PNR: @pnr</label></div>
        </div>
        <div class="table-responsive mgb-20">
            <table id="TblFlight" class="table table-bordered">
                <thead>
                    <tr>
                        <th>Hãng</th>
                        <th>Số hiệu</th>
                        <th>Hành trình</th>
                        <th>Lịch trình</th>
                        <th class="text-center">Hạng</th>
                        <th>Chi phí</th>
                        <th>Tổng chi phí</th>
                    </tr>
                </thead>
                <tbody>
                    @if (tickets.Count() > 0)
                    {
                        foreach (var item in tickets)
                        {
                            double amountFareByFlight = 0;
                            if (tickets.Count > 0)
                            {
                                amountFareTotal = item.Amount / tickets.Count;
                            }
                            <tr>

                                <td>

                                    <label class="lblTrademark">VNA</label>
                                </td>
                                <td>
                                    <i class="fa fa-plane" aria-hidden="true"></i> <label class="lblFlightNo">VN @item.FlightNumber</label> <label>@item.AirEquipType</label>
                                </td>
                                <td>
                                    <label class="lblItinerary">@item.OriginLocation - @item.DestinationLocation; @item.DepartureDateTime</label>
                                </td>
                                <td>
                                    <span class="lblItineraryTime">@item.DepartureDateTime.ToString("HH:mm:ss") - @item.ArrivalDateTime.ToString("HH:mm:ss")</span>
                                </td>
                                <td class="text-center">
                                    <label class="lblResbookdesigcode">@item.ResBookDesigCode</label>
                                </td>
                                <td class="td-inf-price">
                                    <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                        <tbody>
                                            @if (item.BookFares.Count > 0)
                                            {

                                                foreach (var  bookFare in item.BookFares)
                                                {


                                                    int _quantity = bookFare.PassengerQty;
                                                    //double taxOfType = item.BookFares.Where(m => m.PassengerType == _passenger.PassengerType).Sum(m => m.Amount);
                                                    double fareOfType = 0;
                                                    double flightTotal = 0;
                                                    double price = bookFare.Price;
                                                    double taxTotal = bookFare.Tax;


                                                    if (taxTotal > 0 && _quantity > 0)
                                                    {
                                                        fareOfType = price + taxTotal;

                                                        flightTotal = fareOfType * _quantity;
                                                       // fareRound += flightTotal;
                                                    }

                                                    <tr>
                                                        <td>@bookFare.PassengerType</td>
                                                        <td>:</td>
                                                        <td class="text-right">@_quantity</td>
                                                        <td>x</td>
                                                        <td class="text-right">@Helper.Library.FormatToCurrency(fareOfType)</td>
                                                        <td class="text-center">=</td>
                                                        <td class="text-right">@(Helper.Library.FormatThousands(flightTotal)) đ</td>
                                                    </tr>

                                                }
                                            }
                                        </tbody>
                                    </table>
                                </td>
                                <td class="td-faretotal text-right">
                                    <label class="depart-price">@amountFareByFlight 1</label>
                                </td>
                            </tr>
                        }
                    }
                    <tr>
                        <td colspan="7" class="total-itinerary text-right"><label>Tổng:&nbsp; </label> <label class="text-right total-itinerary-price">@Helper.Library.FormatThousands(amountFareTotal) đ</label></td>
                    </tr>
                </tbody>
            </table>

        </div>
        <div class="top-pic mgb-10">
            <label><i class="fa fa-info-circle" aria-hidden="true"></i> Thông tin hành khách:</label>
        </div>
        <div class="table-responsive mgb-20">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th class="text-right"># &nbsp;</th>
                        <th style="width:60px;">Mã hành khách</th>
                        <th>Họ và Tên</th>
                        <th>Giới tính</th>
                        <th>Ngày sinh</th>
                    </tr>
                </thead>
                <tbody>
                    @*@if (passengers != null && passengers.Count() > 0)
                        {
                            int cnt = 0;
                            foreach (var item in passengers.GroupBy(m => new { m.PassengerType }).Select(m => new { m.Key.PassengerType }))
                            {
                                var list = passengers.Where(m => m.PassengerType == item.PassengerType).ToList();
                                string _rowspan = "";
                                if (list.Count() > 1)
                                {
                                    _rowspan = " rowspan=" + @list.Count();
                                }

                                for (int i = 0; i < list.Count(); i++)
                                {
                                    cnt++;

                                    <tr>
                                        <td class="text-right">@cnt &nbsp;</td>
                                        @if (i == 0)
                                        {
                                            <td @(i == 0 ? _rowspan : "")> @list[i].PassengerType</td>
                                        }
                                        <td>@list[i].FullName</td>
                                        <td>@list[i].Gender</td>
                                        <td>@Helper.Library.ConvertDateVN(list[i].DateOfBirth, "-")</td>
                                    </tr>
                                }
                            }
                        }*@
                </tbody>
            </table>
        </div>
        <div class="top-pic mgb-10">
            <label><i class="fa fa-info-circle" aria-hidden="true"></i> Thông tin liên hệ:</label>
        </div>
        <div class="container-fluid mgb-20" style="background: #a2d5d0;">
            <div class="row">
                <div class="col-md-5">
                    <div class="form-group ">
                        <br />
                        <label class="form-label">Số đ.thoại: 0983498218</label>
                    </div>
                    <div class="form-group ">
                        <label class="form-label">Địa chỉ e-mail: vietnt.itt@gmail.com</label>
                    </div>
                </div>
                <div class="col-md-12"> <hr /></div>
            </div>
        </div>

        @if (passengers != null && passengers.Count() > 0)
        {
            <div class="row mgt-20 mgb-25">
                <div class="col-md-8">
                    <div class="form-group">
                        <p class="-warning"><i class="far fa-hand-point-right"></i> 1. Kiểm tra thông tin vé, lịch trình bay.</p>
                        <p class="-warning"><i class="far fa-hand-point-right"></i> 2. Kiểm tra thông tin khách hàng.</p>
                        <p class="-warning"><i class="far fa-hand-point-right"></i> 3. Nhấn button "Xuất vé" để thực hiện lệnh xuất vé.</p>
                        <p class="-warning"><i class="far fa-hand-point-right"></i> 4. Hệ thống sẽ tự động chuyển hướng sau khi lệnh "xuất vé" hoàn tất.</p>
                    </div>
                </div>
                <div class="col-md-4 text-right">
                    <button id="btnBooking" class="btn btn-success -w-100" type="button"><i class="fas fa-arrow-circle-right"></i> Xuất vé</button>
                    <a href="/backend/flightbook/search" class="btn btn-danger -w-100"><i class="fa fa-recycle" aria-hidden="true"></i> Tìm kiếm</a>
                </div>
                <div class="col-md-12">
                    <hr />
                </div>
            </div>
        }
        else
        {
            <div class="row mgt-20 mgb-25">
                <div class="col-md-8">
                    <div class="form-group">
                        <p class="-warning"><i class="far fa-hand-point-right"></i> 1. Thông tin chuyến bay không hợp lệ.</p>
                        <p class="-warning"><i class="far fa-hand-point-right"></i> 2. Vui lòng thực hiện lại lệnh tìm kiếm chuyến bay.</p>
                    </div>
                </div>
                <div class="col-md-4 text-right">
                    <a href="/backend/flightbook/search" class="btn btn-success -w-100"><i class="fa fa-recycle" aria-hidden="true"></i> Tìm kiếm</a>
                </div>
                <div class="col-md-12">
                    <hr />
                </div>
            </div>
        }
    </div>
</div>


-->
